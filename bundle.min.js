let e=globalThis.document;const t="function",a="undefined",n=(e,t)=>typeof e===t,o=(e,t,a)=>(e.addEventListener(t,a),()=>e.removeEventListener(t,a)),r=e=>{const a=new Set;return{get value(){return e},set value(t){e!==t&&(t=>{e=t,a.forEach((t=>t(e)))})(t)},watch:e=>(a.add(e),()=>a.delete(e)),compute(e){return l(e,this)},switch(e,a){return this.compute((o=>o?n(e,t)?e(o):e:n(a,t)?a(o):a))}}},l=(e,...t)=>{const a=()=>e(...t.map((e=>e.value))),n=r(a());return t.forEach((e=>e.watch((()=>n.value=a())))),n},c=e=>{const t=new Map;return new Proxy(e,{get:(e,a)=>(t.has(a)||t.set(a,e.compute((e=>e&&e[a]))),t.get(a)),set:(e,t,a)=>(e.value=Object.assign({},e.value,{[t]:a}),!0)})},s=t=>n(t,a)||null===t?[]:(Array.isArray(t)?t.flat():[t]).map((t=>t.nodeType?t:e.createTextNode(t.toString()))),i=(e,a,o)=>{n(o,t)||n(o,"object")||a in e?e[a]=null===o?"":o:null!==o&&(!1!==o||a.startsWith("aria-")||a.startsWith("data-"))?e.setAttribute(a,o):e.removeAttribute(a)},u=new Proxy(((o,r={},...l)=>{if(n(o,t)){return o(r,...l)}const c=e.createElement(o);r&&Object.entries(r).forEach((([e,t])=>{if("ref"===e&&t.watch)return c.ref=t,t.value=c;t.watch?(t.watch((t=>i(c,e,t))),i(c,e,t.value)):i(c,e,t)}));let u=[];l=l.flat();for(let a of l)if(n(a,t))u.push(a(c));else if(a.watch||a.then){const t=e.createComment(""),n=e=>{for(;o.length;){const e=o.pop();e.ref&&(e.ref.value=null),e.remove()}o=s(e),o.forEach((e=>t.parentNode.insertBefore(e,t)))};let o=s(a.value);a.watch&&a.watch(n),a.then&&a.then(n),u.push(...o,t)}else u.push(a);return u.forEach((e=>!n(e,a)&&c.append(e))),c}),{get:(e,t)=>(...a)=>e(t,...a),apply:(e,t,a)=>e(...a)}),h=r(),d=r({}),p=r(!1),f=c(d),v=e=>{d.value={},p.value=!1,h.value=e||new URL(h.value)};globalThis.window&&(o(window,"click",(e=>{if(!e.target.href)return;const t=e.target.href&&new URL(e.target.href);t&&t.origin===h.value.origin&&(e.preventDefault(),history.pushState({},"",t.href),v(t))})),o(window,"popstate",(()=>v())));const g=({match:e,pattern:t,handler:a},...n)=>{let o=[];if(!e&&t){const a=t.split("/");a.forEach(((e,t)=>{":"===e[0]&&o.push([e.slice(1),t])})),e=e=>{const t=e.pathname.split("/");return t.length===a.length&&t.reduce(((e,t,n)=>e&&(t===a[n]||":"===a[n][0])),!0)}}const r=l((t=>e&&e(t)),h);return r.watch((e=>{e&&(p.value=!0)})),o.length&&r.watch((e=>{if(e){const e=h.value.pathname.split("/");o.forEach((([t,a])=>f[t]=e[a]))}})),l((e=>e?a&&a()||n:void 0),r)},w=({href:e,...t},...a)=>u.a({href:e,...t,class:l((t=>t.pathname===e?"active":""),h)},...a),m=r([]),b=(e,t)=>{const a=m.value,n=a[e];m.value=Object.assign([],a,{[e]:{...n,...t}})},y=({todo:e,index:t})=>{const a=c(r(e)),n=r(null);return n.watch((e=>e&&requestAnimationFrame((()=>e.select())))),u.li({class:"todo"},u.input({type:"checkbox",checked:a.done,onclick:e=>b(t,{done:!!e.target.checked})}),a.editing.switch((e=>u.input({type:"text",value:a.text,ref:n,onblur:e=>b(t,{text:e.target.value,editing:!1}),onkeydown:e=>{"Enter"===e.key&&b(t,{text:e.target.value,editing:!1}),"Escape"===e.key&&b(t,{editing:!1})}})),(e=>u.span({onclick:()=>b(t,{editing:!0})},a.text))),a.done.switch((t=>u.button({class:"icon",onclick:()=>(e=>{m.value=m.value.filter((t=>t!==e))})(e)},"🗑️"))))},x=()=>u.div({class:"content"},u.ul({class:"todos"},l((e=>e.map(((e,t)=>y({todo:e,index:t})))),m)),u.form({onsubmit:e=>{var t;e.preventDefault(),t=e.target.elements.todo.value,m.value=[...m.value,{text:t,done:!1}],e.target.reset()},onclick:console.log},u.input({type:"text",name:"todo"}),u.button({class:"icon"},"➕")));let E;h.value=new URL(window.location);try{E=JSON.parse(localStorage.getItem("todos"))}catch(e){}m.value=E||[{text:"first",done:!1},{text:"second",done:!0}],m.watch((e=>localStorage.setItem("todos",JSON.stringify(e)))),document.body.replaceChildren(u.div({class:"app"},u.header({},u.h1({},"Todos"),w({href:"/"},"home"),w({href:"/about"},"about")),g({pattern:"/",handler:x}),g({pattern:"/about"},u.h1({},"About"))));
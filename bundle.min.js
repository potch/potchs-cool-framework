const e=e=>{let t=new Set;return{get value(){return e},set value(a){e!==a&&(e=a,t.forEach((t=>t(e))))},watch:(a,n=!1)=>(t.add(a),n&&a(e),()=>t.delete(a))}},t=(t,...a)=>{let n=e(),[o]=((e,...t)=>{let a=()=>e(...t.map((e=>e.value))),n=t.map((e=>e.watch(a)));return[a,()=>n.forEach((e=>e()))]})(((...e)=>n.value=t(...e)),...a);return o(),n};let a=globalThis.document;const n="function",o="undefined",r=(e,t)=>typeof e===t,l=(e,t,a)=>(e.addEventListener(t,a),()=>e.removeEventListener(t,a)),c=(e,a,o)=>t((e=>e?r(a,n)?a(e):a:r(o,n)?o(e):o),e),s=e=>{const a=new Map;return new Proxy(e,{get:(e,n)=>(a.has(n)||a.set(n,t((e=>e&&e[n]),e)),a.get(n)),set:(e,t,a)=>(e.value=Object.assign({},e.value,{[t]:a}),!0)})},i=e=>r(e,o)||null===e?[]:(Array.isArray(e)?e.flat():[e]).map((e=>e.nodeType?e:a.createTextNode(e.toString()))),u=(e,t,a)=>{r(a,n)||r(a,"object")||t in e?e[t]=null===a?"":a:null!==a&&(!1!==a||t.startsWith("aria-")||t.startsWith("data-"))?e.setAttribute(t,a):e.removeAttribute(t)},h=new Proxy(((e,t={},...l)=>{if(r(e,n)){return e(t,...l)}const c=a.createElement(e);t&&Object.entries(t).forEach((([e,t])=>{if("ref"===e&&t.watch)return c.ref=t,t.value=c;t.watch?(t.watch((t=>u(c,e,t))),u(c,e,t.value)):u(c,e,t)}));let s=[];l=l.flat();for(let e of l)if(r(e,n))s.push(e(c));else if(e.watch||e.then){const t=a.createComment(""),n=e=>{for(;o.length;){const e=o.pop();e.ref&&(e.ref.value=null),e.remove()}o=i(e),o.forEach((e=>t.parentNode.insertBefore(e,t)))};let o=i(e.value);e.watch&&e.watch(n),e.then&&e.then(n),s.push(...o,t)}else s.push(e);return s.forEach((e=>!r(e,o)&&c.append(e))),c}),{get:(e,t)=>(...a)=>e(t,...a),apply:(e,t,a)=>e(...a)}),d=e(),p=e({}),f=e(!1),v=s(p),g=e=>{p.value={},f.value=!1,d.value=e||new URL(d.value)};globalThis.window&&(l(window,"click",(e=>{if(!e.target.href)return;const t=e.target.href&&new URL(e.target.href);t&&t.origin===d.value.origin&&(e.preventDefault(),history.pushState({},"",t.href),g(t))})),l(window,"popstate",(()=>g())));const w=({match:e,pattern:a,handler:n},...o)=>{let r=[];if(!e&&a){const t=a.split("/");t.forEach(((e,t)=>{":"===e[0]&&r.push([e.slice(1),t])})),e=e=>{const a=e.pathname.split("/");return a.length===t.length&&a.reduce(((e,a,n)=>e&&(a===t[n]||":"===t[n][0])),!0)}}const l=t((t=>e&&e(t)),d);return l.watch((e=>{e&&(f.value=!0)}),!0),r.length&&l.watch((e=>{if(e){const e=d.value.pathname.split("/");r.forEach((([t,a])=>v[t]=e[a]))}})),t((e=>e?n&&n()||o:void 0),l)},m=({href:e,...a},...n)=>h.a({href:e,...a,class:t((t=>t.pathname===e?"active":""),d)},...n),b=e([]),y=(e,t)=>{const a=b.value,n=a[e];b.value=Object.assign([],a,{[e]:{...n,...t}})},x=({todo:t,index:a})=>{const n=s(e(t)),o=e(null);return o.watch((e=>e&&requestAnimationFrame((()=>e.select())))),h.li({class:"todo"},h.input({type:"checkbox",checked:n.done,onclick:e=>y(a,{done:!!e.target.checked})}),c(n.editing,(e=>h.input({type:"text",value:n.text,ref:o,onblur:e=>y(a,{text:e.target.value,editing:!1}),onkeydown:e=>{"Enter"===e.key&&y(a,{text:e.target.value,editing:!1}),"Escape"===e.key&&y(a,{editing:!1})}})),(e=>h.span({onclick:()=>y(a,{editing:!0})},n.text))),c(n.done,(e=>h.button({class:"icon",onclick:()=>(e=>{b.value=b.value.filter((t=>t!==e))})(t)},"🗑️"))))},E=()=>h.div({class:"content"},h.ul({class:"todos"},t((e=>e.map(((e,t)=>x({todo:e,index:t})))),b)),h.form({onsubmit:e=>{var t;e.preventDefault(),t=e.target.elements.todo.value,b.value=[...b.value,{text:t,done:!1}],e.target.reset()},onclick:console.log},h.input({type:"text",name:"todo"}),h.button({class:"icon"},"➕")));d.value=new URL(window.location),b.value=JSON.parse(((e,t=a)=>t.querySelector(e))('[data-signal="todos"]').innerText),fetch("/todos").then((e=>e.json())).then((e=>{b.value=e,b.watch((e=>{localStorage.setItem("todos",JSON.stringify(e)),fetch("/todos",{method:"post",body:JSON.stringify(e.map((({text:e,done:t})=>({text:e,done:t}))))})})),document.body.replaceChildren(h.div({class:"app"},h.header({},h.h1({},"Todos"),m({href:"/"},"home"),m({href:"/about"},"about")),w({pattern:"/",handler:E}),w({pattern:"/about"},h.h1({},"About"))))}));